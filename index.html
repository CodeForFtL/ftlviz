<!DOCTYPE html>
<html>

	<head>
		<title>Fort Lauderdale Visualization</title>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css">
		<link rel="stylesheet" href="dist/leaflet.awesome-markers.css">

		<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
		<script src="http://maps.google.com/maps/api/js?v=3&sensor=false"></script>
		<script src="Google.js"></script>
		<script src="GoogleTraffic.js"></script>
		<script src="dist/leaflet.awesome-markers.js"></script>

		<style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
				.info {
					padding: 6px 8px;
			    font: 14px/16px Arial, Helvetica, sans-serif;
			    background: white;
			    background: rgba(255,255,255,0.8);
			    box-shadow: 0 0 15px rgba(0,0,0,0.2);
			    border-radius: 5px;
				}
				.info h4 {
						margin: 0 0 5px;
						color: #777;
				}
				.control {
					padding: 6px 8px;
					font: 14px/16px Arial, Helvetica, sans-serif;
					background: white;
					background: rgba(255,255,255,0.8);
					box-shadow: 0 0 15px rgba(0,0,0,0.2);
					border-radius: 5px;
				}
				.control h4 {
				    margin: 0 0 5px;
				    color: #777;
				}
    </style>
	</head>

	<body >
		<div id="map"></div>

		<script>

		// Initialize map
		var map = L.map('map').setView([26.123679,-80.143186], 12);

		// Load MapBox map
		var accessToken = 'pk.eyJ1IjoicXRyYW5kZXYiLCJhIjoiSDF2cGNjZyJ9.D1ybOKe77AQDPHkxCCEpJQ';
		var osmLayer = L.tileLayer('https://{s}.tiles.mapbox.com/v4/qtrandev.lc0i743k/{z}/{x}/{y}.png?access_token=' + accessToken, {
			maxZoom: 20,
		  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
		    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
		    'Imagery &copy; <a href="http://mapbox.com">Mapbox</a>'
		});

		// Set up Google Maps layers
		var googleRoadmap = new L.Google('ROADMAP', { maxZoom: 20 });
		var googleHybrid = new L.Google('HYBRID', { maxZoom: 20 });
		var googleTraffic = new L.GoogleTraffic('ROADMAP', { maxZoom: 20 });
		var cipPointsLayer = new L.LayerGroup();
		var browardPointsLayer = new L.LayerGroup();
		var cipRoadsLayer = new L.LayerGroup();
		var browardRoadsLayer = new L.LayerGroup();
		map.addLayer(googleTraffic);

		var control = L.control.layers({'Google Map':googleRoadmap, 'Google Satellite':googleHybrid, 'Google Traffic':googleTraffic, 'OpenStreetMap':osmLayer},{
			'CIP (Capital Improvement Plan) Points': cipPointsLayer,
			'CIP (Capital Improvement Plan) Roads': cipRoadsLayer,
			'Broward Construction Programs Points': browardPointsLayer,
			'Broward Construction Programs Roads': browardRoadsLayer
		});

		var redMarker = L.AwesomeMarkers.icon({
			icon: 'star',
			markerColor: 'red',
			prefix: 'fa'
		});

		var greenMarker = L.AwesomeMarkers.icon({
			icon: 'university',
			markerColor: 'green',
			prefix: 'fa'
		});
		var blueMarker = L.AwesomeMarkers.icon({
			icon: 'truck',
			markerColor: 'blue',
			prefix: 'fa'
		});
		var geojsonHighlight;
		var geojsonHighlightBroward;

		var info = L.control();

		info.onAdd = function (map) {
			this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
			this.update();
			return this._div;
		};

		// method that we will use to update the control based on feature properties passed
		info.update = function (props) {
			var display = '<h4>Fort Lauderdale Visualization</h4>';
			if (props) {
				var desc;
				var details;
				if (props.loc_desc) {
					desc = props.loc_desc;
					details = props.countydesc +
						'<br>' + props.project_ma +
						'<br>' + props.status +
						'<br>FY22: ' + props.fy22 +
						'<br>FY32: ' + props.fy32 +
						'<br>FY52: ' + props.fy52 +
						'<br>FY58: ' + props.fy58 +
						'<br>FY58WP: ' + props.fy5wp;
				} else {
					desc = props.descriptio;
					details = props.fy;
				}
				display = display + '<br><b>' + desc + '</b>' +
					'<br>' + details;
			} else {
				display = display + '<br>Hover over or click a road or marker';
			}
			this._div.innerHTML = display;
		};

		info.addTo(map);
		control.addTo(map);
		// Add layers to map for toggling hide/show
		map.addLayer(cipPointsLayer);
		map.addLayer(browardPointsLayer);
		map.addLayer(cipRoadsLayer);
		map.addLayer(browardRoadsLayer);
		var showCipPoints = true;
		var showBrowardPoints = true;
		var showCipRoads = true;
		var showBrowardRoads = true;

		function addLocations() {
			var i = 0;
			for (i = 0; i < locations.length; i++) {
				addMarker(
					locations[i].name,
					locations[i].url,
					locations[i].desc,
					locations[i].lat,
					locations[i].lng
				);
			}
		}

		function addMarker(name, url, desc, lat, lng) {
			var marker = L.marker([lat, lng], {icon: redMarker}).bindPopup(
		      '<strong>' + name + '</strong><br><br>' + '<a href="' + url + '" target="blank">' + url + '</a>' + '<br><br>' +  desc,
		      { offset: new L.Point(0, -22) }).addTo(map);
		}

		var locations = [
			{ name: "Fort Lauderdale", url: "http://www.fortlauderdale.gov", desc: "The City of Fort Lauderdale!" , lat: 26.123679, lng: -80.143186},
			{ name: "Code for Fort Lauderdale", url: "http://www.codeforftl.org", desc: "Code for Fort Lauderdale!" , lat: 26.0802, lng: -80.243259},
		];

		function addGeoJson(location, displayFunction) {
			$.getJSON(location, function(data) {
				var geojson = L.geoJson(data, {
		      onEachFeature: displayFunction });
		    geojson.addTo(map);
		  });
		}

		function addGeoJsonCustom(location, displayFunction, pointFunction) {
			$.getJSON(location, function(data) {
				var geojson = L.geoJson(data, {
		      onEachFeature: displayFunction,
					pointToLayer: pointFunction });
		    geojson.addTo(map);
		  });
		}

		function addGeoJsonStyleHighlightBroward(location, displayFunction, styleFunction) {
			$.getJSON(location, function(data) {
				geojsonHighlightBroward = L.geoJson(data, {
		      onEachFeature: displayFunction,
					style: styleFunction });
				geojsonHighlightBroward.addTo(map);
		  });
		}

		function addGeoJsonStyleHighlight(location, displayFunction, styleFunction) {
			$.getJSON(location, function(data) {
				geojsonHighlight = L.geoJson(data, {
		      onEachFeature: displayFunction,
					style: styleFunction });
				geojsonHighlight.addTo(map);
		  });
		}

		/** Code execution begins here */
		addLocations();
		addControlPane();
		addGeoJsonCustom("ftl_pt_workprogram_2014_2018.geojson",
		function (feature, layer) {
			layer.bindPopup(
				'<strong>'+feature.properties.loc_desc+'</strong>'+
				'<br><br>County: '+feature.properties.countydesc+
				'<br>Project Manager: '+feature.properties.project_ma+
				'<br>Status: '+feature.properties.status+
				'<br>FY22: '+feature.properties.fy22+
				'<br>FY32: '+feature.properties.fy32+
				'<br>FY52: '+feature.properties.fy52+
				'<br>FY58: '+feature.properties.fy58+
				'<br>FY58WP: '+feature.properties.fy5wp);
		},
		function (feature, latlng) {
			var marker = L.marker(latlng, {icon: blueMarker})
			marker.on({
        mouseover: function (e) {
					info.update(e.target.feature.properties)
				},
        mouseout: function (e) {
					info.update()
				}
			});
			marker.addTo(browardPointsLayer);
    	return marker;
  	});

		addGeoJsonStyleHighlightBroward("bwdco_ftl_const.geojson", function (feature, layer) {
			layer.addTo(browardRoadsLayer);
			layer.on({
        mouseover: highlightFeatureBroward,
        mouseout: resetHighlightBroward
			});
			layer.bindPopup(
				'<strong>'+feature.properties.loc_desc+'</strong>'+
				'<br><br>County: '+feature.properties.countydesc+
				'<br>Project Manager: '+feature.properties.project_ma+
				'<br>Status: '+feature.properties.status+
				'<br>FY22: '+feature.properties.fy22+
				'<br>FY32: '+feature.properties.fy32+
				'<br>FY52: '+feature.properties.fy52+
				'<br>FY58: '+feature.properties.fy58+
				'<br>FY58WP: '+feature.properties.fy5wp);
		},
		function (feature) {
			return {
				fillColor: 'green',
				weight: 3,
        opacity: 1,
        color: 'blue',
        dashArray: '3',
        fillOpacity: 0.7
	    };
		});

		addGeoJsonCustom("cip_projects_pt.geojson",
		function (feature, layer) {
			layer.bindPopup(
				'<strong>'+feature.properties.descriptio+'</strong>'+
				'<br><br>FY: '+feature.properties.fy+
				'<br>ID: '+feature.properties.id+
				'<br>ID1: '+feature.properties.id_1+
				'<br>Number: '+feature.properties.number+
				'<br>Ex_Airport: '+feature.properties.ex_airport);
		},
		function (feature, latlng) {
			var marker = L.marker(latlng, {icon: greenMarker})
			marker.on({
        mouseover: function (e) {
					info.update(e.target.feature.properties)
				},
        mouseout: function (e) {
					info.update()
				}
			});
			marker.addTo(cipPointsLayer);
    	return marker;
  	});

		addGeoJsonStyleHighlight("cip_projects_line.geojson",
		function (feature, layer) {
			layer.addTo(cipRoadsLayer);
			layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight
			});
			layer.bindPopup(
				'<strong>'+feature.properties.descriptio+'</strong>'+
				'<br><br>FY: '+feature.properties.fy+
				'<br>ID: '+feature.properties.id+
				'<br>ID1: '+feature.properties.id_1+
				'<br>Number: '+feature.properties.number+
				'<br>Ex_Airport: '+feature.properties.ex_airport);
		},
		function (feature) {
			return {
				fillColor: 'green',
				weight: 3,
        opacity: 1,
        color: 'red',
        dashArray: '3',
        fillOpacity: 0.7
	    };
		});

		function highlightFeature(e) {
			var layer = e.target;
	    layer.setStyle({
	        weight: 7,
	        color: 'green',
	        dashArray: '7',
	        fillOpacity: 0.7
	    });
	    if (!L.Browser.ie && !L.Browser.opera) {
	        layer.bringToFront();
	    }
			info.update(layer.feature.properties);
		}

		function resetHighlight(e) {
			geojsonHighlight.resetStyle(e.target);
			info.update();
		}

		function highlightFeatureBroward(e) {
			var layer = e.target;
	    layer.setStyle({
	        weight: 7,
	        color: 'green',
	        dashArray: '7',
	        fillOpacity: 0.7
	    });
	    if (!L.Browser.ie && !L.Browser.opera) {
	        layer.bringToFront();
	    }
			info.update(layer.feature.properties);
		}

		function resetHighlightBroward(e) {
			geojsonHighlightBroward.resetStyle(e.target);
			info.update();
		}

		function addControlPane() {
			var control = L.control({position: 'bottomright'});
			control.onAdd = function (map) {
		    this._div = L.DomUtil.create('div', 'control'); // create a div with a class "control"
		    this.update();
		    return this._div;
		  };

			control.update = function () {
		    this._div.innerHTML = '<h4>Filters</h4>'+
				'<br><button type="button" class="btn btn-primary"  onclick="showAll()">All</button>'+
				'<br><br><button type="button" class="btn btn-primary"  onclick="toggleCipPoints()">CIP Points</button>'+
				'<br><br><button type="button" class="btn btn-primary"  onclick="toggleCipRoads()">CIP Roads</button>'+
				'<br><br><button type="button" class="btn btn-primary"  onclick="toggleBrowardPoints()">Broward Points</button>'+
				'<br><br><button type="button" class="btn btn-primary"  onclick="toggleBrowardRoads()">Broward Roads</button>';
		  };

			control.addTo(map);
		}

		function showAll() {
			map.addLayer(cipPointsLayer);
			map.addLayer(browardPointsLayer);
			map.addLayer(cipRoadsLayer);
			map.addLayer(browardRoadsLayer);
			showCipPoints = true;
			showBrowardPoints = true;
			showCipRoads = true;
			showBrowardRoads = true;
		}

		function toggleCipPoints() {
			showCipPoints? map.removeLayer(cipPointsLayer) : map.addLayer(cipPointsLayer);
			showCipPoints = !showCipPoints;
		}

		function toggleCipRoads() {
			showCipRoads? map.removeLayer(cipRoadsLayer) : map.addLayer(cipRoadsLayer);
			showCipRoads = !showCipRoads;
		}

		function toggleBrowardPoints() {
			showBrowardPoints? map.removeLayer(browardPointsLayer) : map.addLayer(browardPointsLayer);
			showBrowardPoints = !showBrowardPoints;
		}

		function toggleBrowardRoads() {
			showBrowardRoads? map.removeLayer(browardRoadsLayer) : map.addLayer(browardRoadsLayer);
			showBrowardRoads = !showBrowardRoads;
		}

		</script>

	</body>

</html>
